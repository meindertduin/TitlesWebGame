@page "/game"
@inject GameSessionState GameSessionState;
@using TitlesWebGame.WebUi.Services
@using TitlesWebGame.WebUi.ViewModels
@using TitlesWebGame.WebUi.Models
@implements IDisposable;
@inject GameViewModel GameViewModel; 


<CascadingValue Value="@GameViewModel" Name="GameViewModel">
    @if (GameViewModel.IsPlaying)
    {
        <CoreGame />
    }
    else
    {
        <GameSessionLobby />
    }
</CascadingValue>

@code {

    protected override async Task OnInitializedAsync()
    {
        GameViewModel.PropertyChanged += OnPropertyChangedHandler;
        await base.OnInitializedAsync();
    }

    public async void OnPropertyChangedHandler(object sender, ViewModelPropertyChangedEventArgs e)
    {
        await InvokeAsync(StateHasChanged);
    }
    
    public void Dispose()
    {
        GameViewModel.PropertyChanged -= OnPropertyChangedHandler;
        GameViewModel.Dispose();
    }
}